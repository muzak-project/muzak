#!/usr/bin/env ruby

require "muzak"
require "socket"

def fatal(msg)
  STDERR.puts "Fatal: #{msg}"
  exit 1
end

def dmenu(options)
	dmenu = Muzak::Config.dmenu_exec || "dmenu"
	opts = options.join("\n")
	`printf "#{opts}" | #{dmenu}`
end

begin
  server_host = Muzak::Config.daemon_host
  server_port = Muzak::Config.daemon_port
  sock = TCPSocket.new server_host, server_port
rescue
  fatal "Is muzakd running?"
end

command = dmenu Muzak::Cmd.commands

sock.puts command unless command.empty?
puts sock.gets

sock.close
